---
title: Git 工作流
date: 2018-06-13 00:43:46
tags: 版本控制
---
# 一 两种开发合作模式
参考：[参考问题回答](https://segmentfault.com/q/1010000004362882/a-1020000004415897)

当自己属于主仓库团队项目贡献者一员时，可选择是否 pull request 或 code review；
不是其中一员则必须 fork 一份到自己的远端仓库，从自己的远端仓库请求 pull request 到主仓库。

1. 大家使用同一个仓库进行合作开发。分支开发功能，开发完毕，建立 merge request，进行 code review，最终合并到 dev 分支。

2. 大家 fork 仓库。开发完毕后，从自己的远端仓库建立 pull request 到主仓库的 dev 分支，由管理代码的人进行合并。

# 二 概述 Github flow
1. 创建一个新分支。
同一时刻多个想法，创建分支来进行管理。

2. 添加新版本。
不断做新功能出来。

3. 开启一个 pull request。
发起对做的各个版本的讨论，代码审核。

4. 合并分支，然后部署。
大家审核了 pull request 并通过测试，后合并到主分支上。


# 三 详细 Git flow
1. 项目管理者创建 master 分支，在 master 分支上创建 dev 分支。

2. 任务分配给不同的人员（不同特性）：
- 不同人员克隆主仓库到本地，在克隆的仓库的 dev 分支上创建自己的特性分支（或 fork 此项目后，克隆到本地，在其 dev 分支上创建自己的特性分支）。

- 然后可以提交自己的分支到远端主仓库备份，让其他成员知道进度，远程跟踪分支 `git push -u origin feature`（或提交自己的分支到自己 fork 的远端主仓库）。

3. 进行自己特性分支上的开发。

4. 更新、合并、推送：
- 从远端主仓库获取，更新本地的 dev 分支，注意区别，`git pull`=`git fetch + git merge(rebase)`；
- 可能要处理冲突；
- 处理完冲突 commit，将更新后的本地 dev 分支 merge 到自己的任务分支，得到要推送的分支。也可以用 rebase 来将更新的本地 dev 分支与自己的特性分支合并，得到要推送的分支（rebase 和 merge 效果一样，但让之前的分支提交记录消失，让分支线看起来更清晰）。
- 或然后 pull request（然后进入第 5 点中第一步）；
或等待由管理者创建临时分支合并测试，合并特性分支与被合并分支，删除临时分支，结束；
或直接合并到远端主 dev 分支（可能要加上 --force 参数强制推送代码，改变提交历史记录，慎用），结束。

5. 团队需要 pull request，管理者收到 pull request：
- 将自己的本地仓库与请求者 fork 的远程仓库关联，并获取代码。（同仓库合作开发则直接下一步。）
- 在 dev 分支上创建并切换到临时分支。
- 将请求分支（部分）与临时分支合并，进行测试。
- 测试没问题后删除临时分支，接受 pull request。
- 有问题则在 pull request 中讨论和解决问题，要求请求者解决，或管理者在临时分支上测试并解决后将此临时分支与被请求合并的分支合并，删除临时分支。

6. 注：在开始下个任务前或任务中需注意更新自己本地的 dev 分支。

# 四 各分支使用
> GitFlow：git 的最佳实践。
项目地址：https://github.com/nvie/gitflow
文章：https://nvie.com/posts/a-successful-git-branching-model/

git 的最佳实践简化图：
![git 的最佳实践简化图](图1.PNG)

1. master 分支作为中央仓库主分支，并且功能分支不是从 master 分支上拉出新分支，而是使用 deve 分支作为父分支。

2. 一旦 develop 分支上有了做一次发布（或者说快到了既定的发布日）的足够功能，就从 develop 分支上 fork 一个发布分支，即 release。新建的分支用于开始发布循环，所以从这个时间点开始之后新的功能不能再加到这个分支上,这个分支只应该做 Bug 修复、文档生成和其它面向发布任务。一旦对外发布的工作都完成了，发布分支合并到 master 分支并分配一个版本号打好 Tag。另外，这些从新建发布分支以来的做的修改要合并回 develop 分支。

3. 预发布分支命名: release-

4. 维护分支或说是热修复（hotfix）分支用于生成快速给产品发布版本（production releases）打补丁，这是唯一可以直接从 master 分支 fork 出来的分支。修复完成，修改应该马上合并回 master 分支和 dev 分支（当前的发布分支），master 分支应该用新的版本号打好 Tag。

# 五 实践